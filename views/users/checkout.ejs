<%- include ('../layouts/header') %>
    <div class="header-small-mobile section-padding-1">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-6">
                    <div class="mobile-logo logo-width">
                        <a href="index.html">
                            <img alt="" src="assets/images/logo/logo.png">
                        </a>
                    </div>
                </div>
                <div class="col-6">
                    <div class="mobile-header-right-wrap">
                        <div class="header-right-wrap header-right-flex">
                            <div class="same-style cart-wrap">
                                <a href="#" class="cart-active">
                                    <i class="dlicon shopping_bag-20"></i>
                                    <span class="count-style">02</span>
                                </a>
                            </div>
                            <div class="same-style header-off-canvas">
                                <a class="header-aside-button" href="#">
                                    <i class="dlicon ui-3_menu-left"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- search start -->
    <div class="search-content-wrap main-search-active">
        <a class="search-close"><i class="dlicon ui-1_simple-remove"></i></a>
        <div class="search-content">
            <p>Start typing and press Enter to search</p>
            <form class="search-form" action="#">
                <input type="text" placeholder="Search">
                <button class="button-search"><i class="dlicon ui-1_zoom"></i></button>
            </form>
        </div>
    </div>
    <!-- mini cart start -->
    <div class="sidebar-cart-active">
        <div class="sidebar-cart-all">
            <a class="cart-close" href="#"><i class="dlicon ui-1_simple-remove"></i></a>
            <div class="cart-content">
                <h3>Shopping Cart</h3>
                <ul>
                    <li class="single-product-cart">
                        <div class="cart-img">
                            <a href="#"><img src="assets/images/cart/cart-1.jpg" alt=""></a>
                        </div>
                        <div class="cart-title">
                            <h4><a href="#">Bejewelled velvet sandals</a></h4>
                            <span> 1 × $49.00 </span>
                        </div>
                        <div class="cart-delete">
                            <a href="#">×</a>
                        </div>
                    </li>
                    <li class="single-product-cart">
                        <div class="cart-img">
                            <a href="#"><img src="assets/images/cart/cart-2.jpg" alt=""></a>
                        </div>
                        <div class="cart-title">
                            <h4><a href="#">Contrast faux fur jacket</a></h4>
                            <span> 1 × $49.00 </span>
                        </div>
                        <div class="cart-delete">
                            <a href="#">×</a>
                        </div>
                    </li>
                </ul>
                <div class="cart-total">
                    <h4>Subtotal: <span>$170.00</span></h4>
                </div>
                <div class="cart-checkout-btn">
                    <a class="btn-hover cart-btn-style" href="/cart">view cart</a>
                    <a class="no-mrg btn-hover cart-btn-style" href="/order">checkout</a>
                </div>
            </div>
        </div>
    </div>
    <!-- aside start -->
    <div class="header-aside-active">
        <div class="header-aside-wrap">
            <a class="aside-close"><i class="dlicon ui-1_simple-remove"></i></a>
            <div class="header-aside-content">
                <div class="mobile-menu-area">
                    <div class="mobile-search">
                        <form class="search-form" action="#">
                            <input type="text" placeholder="Search entire store…">
                            <button class="button-search"><i class="dlicon ui-1_zoom"></i></button>
                        </form>
                    </div>
                    <div class="mobile-menu-wrap">
                        <!-- mobile menu start -->
                        <div class="mobile-navigation">
                            <!-- mobile menu navigation start -->
                            <nav>
                                <ul class="mobile-menu">
                                    <li class="menu-item-has-children"><a href="index.html">Home</a>
                                        <ul class="dropdown">
                                            <li class="menu-item-has-children"><a href="#">Demo Group 01</a>
                                                <ul class="dropdown">
                                                    <li><a href="index.html">Home 01</a></li>
                                                    <li><a href="index-2.html">Home 02</a></li>
                                                    <li><a href="index-3.html">Home 03</a></li>
                                                    <li><a href="index-4.html">Home 04</a></li>
                                                    <li><a href="index-5.html">Home 05</a></li>
                                                    <li><a href="index-6.html">Home 06</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><a href="#">Demo Group 02</a>
                                                <ul class="dropdown">
                                                    <li><a href="index-7.html">Home 07</a></li>
                                                    <li><a href="index-8.html">Home 08</a></li>
                                                    <li><a href="index-9.html">Home 09</a></li>
                                                    <li><a href="index-10.html">Home 10</a></li>
                                                    <li><a href="index-11.html">Home 11</a></li>
                                                    <li><a href="index-12.html">Home 12</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><a href="#">Demo Group 03</a>
                                                <ul class="dropdown">
                                                    <li><a href="index-13.html">Home 13</a></li>
                                                    <li><a href="index-14.html">Home 14</a></li>
                                                    <li><a href="index-15.html">Home 15</a></li>
                                                    <li><a href="index-16.html">Home 16</a></li>
                                                    <li><a href="index-17.html">Home 17</a></li>
                                                    <li><a href="index-18.html">Home 18</a></li>
                                                    <li><a href="index-19.html">Home 19</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><a href="#">Pages</a>
                                        <ul class="dropdown">
                                            <li><a href="about-us.html">About Us</a></li>
                                            <li><a href="contact-us.html">Contact Page</a></li>
                                            <li><a href="404.html">404 Page</a></li>
                                            <li><a href="comming-soon.html">Comming Soon 01</a></li>
                                            <li><a href="comming-soon-2.html">Comming Soon 02</a></li>
                                            <li><a href="faq.html">FAQ</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children "><a href="shop-fullwide.html">shop</a>
                                        <ul class="dropdown">
                                            <li class="menu-item-has-children"><a href="#">Shop Layout</a>
                                                <ul class="dropdown">
                                                    <li><a href="shop-fullwide.html">Shop Fullwidth</a></li>
                                                    <li><a href="shop-sidebar.html">Shop Sidebar</a></li>
                                                    <li><a href="shop-metro.html">Shop Metro Layout</a></li>
                                                    <li><a href="shop-3-col.html">Shop 03 Columns</a></li>
                                                    <li><a href="shop-2-col.html">Shop 02 Columns</a></li>
                                                    <li><a href="shop-collection-1.html">Shop Collection 01</a></li>
                                                    <li><a href="shop-collection-2.html">Shop Collection 02</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><a href="#">Product Layout</a>
                                                <ul class="dropdown">
                                                    <li><a href="product-details.html">Single 01</a></li>
                                                    <li><a href="product-details-2.html">Single 02</a></li>
                                                    <li><a href="product-details-group.html">Grouped</a></li>
                                                    <li><a href="product-details-sticky.html">Sticky Info</a></li>
                                                    <li><a href="product-details-configurable.html">Configurable</a>
                                                    </li>
                                                    <li><a href="product-details-thumbnail.html">Thumbnail</a></li>
                                                    <li><a href="product-details-video.html">Video</a></li>
                                                    <li><a href="product-details-affiliate.html">Affiliate</a></li>
                                                    <li><a href="product-details-sidebar.html">Sidebar</a></li>
                                                </ul>
                                            </li>
                                            <li class="menu-item-has-children"><a href="#">Shop Pages </a>
                                                <ul class="dropdown">
                                                    <li><a href="my-account.html">My Account</a></li>
                                                    <li><a href="/order">Check Out</a></li>
                                                    <li><a href="cart.html">Shopping Cart</a></li>
                                                    <li><a href="wishlist.html">Wishlist</a></li>
                                                    <li><a href="order-tracking.html">Order Tracking</a></li>
                                                    <li><a href="compare.html">Compare</a></li>
                                                    <li><a href="login-register.html">login / register</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children "><a href="shop-collection-1.html">Collection</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-collection-1.html">Shop Collection 01</a></li>
                                            <li><a href="shop-collection-2.html">Shop Collection 02</a></li>
                                            <li><a href="shop-metro.html">Shop Metro Layout</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children "><a href="blog.html">Blog</a>
                                        <ul class="dropdown">
                                            <li><a href="blog.html">Blog Style 01</a></li>
                                            <li><a href="blog-2.html">Blog Style 02</a></li>
                                            <li><a href="blog-3.html">Blog Style 03</a></li>
                                            <li><a href="blog-details.html">Single Post Style 01</a></li>
                                            <li><a href="blog-details-2.html">Single Post Style 02</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="shop-instagram.html">Instagram Shop </a></li>
                                </ul>
                            </nav>
                            <!-- mobile menu navigation end -->
                        </div>
                        <!-- mobile menu end -->
                    </div>
                    <div class="mobile-curr-lang-wrap">
                        <div class="single-mobile-curr-lang">
                            <a class="mobile-language-active" href="#">Language <i class="fa fa-angle-down"></i></a>
                            <div class="lang-curr-dropdown lang-dropdown-active">
                                <ul>
                                    <li><a href="#">English (US)</a></li>
                                    <li><a href="#">English (UK)</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="single-mobile-curr-lang">
                            <a class="mobile-currency-active" href="#">Currency <i class="fa fa-angle-down"></i></a>
                            <div class="lang-curr-dropdown curr-dropdown-active">
                                <ul>
                                    <li><a href="#">USD</a></li>
                                    <li><a href="#">EUR</a></li>
                                    <li><a href="#">Real</a></li>
                                    <li><a href="#">BDT</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="single-mobile-curr-lang">
                            <a class="mobile-account-active" href="#">My Account <i class="fa fa-angle-down"></i></a>
                            <div class="lang-curr-dropdown account-dropdown-active">
                                <ul>
                                    <li><a href="#">Login</a></li>
                                    <li><a href="#">Creat Account</a></li>
                                    <li><a href="my-account.html">My Account</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-aside-menu">
                    <nav>
                        <ul>
                            <li><a href="#">About Toro</a></li>
                            <li><a href="#">Help Center</a></li>
                            <li><a href="#">Collection</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">New Look</a></li>
                        </ul>
                    </nav>
                </div>
                <img src="assets/images/icon-img/payments.png" alt="payment">
                <p>Pellentesque mollis nec orci id tincidunt. Sed mollis risus eu nisi aliquet, sit amet fermentum justo
                    dapibus.</p>
                <div class="aside-contact-info">
                    <ul>
                        <li><i class="dlicon ui-2_time-clock"></i>Monday - Friday: 9:00 - 19:00</li>
                        <li><i class="dlicon ui-1_email-84"></i>Info@la-studioweb.com</li>
                        <li><i class="dlicon tech-2_rotate"></i>(+55) 254. 254. 254</li>
                        <li><i class="dlicon ui-1_home-minimal"></i>Helios Tower 75 Tam Trinh Hoang - Ha Noi - Viet Nam
                        </li>
                    </ul>
                </div>
                <div class="social-icon-style mb-25">
                    <a class="facebook" href="#"><i class="fa fa-facebook"></i></a>
                    <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
                    <a class="google-plus" href="#"><i class="fa fa-google-plus"></i></a>
                    <a class="behance" href="#"><i class="fa fa-behance"></i></a>
                </div>
                <div class="copyright">
                    <p>© 2021 <a href="https://hasthemes.com/">Toro.</a> All rights reserved</p>
                </div>
            </div>
        </div>
    </div>
    <div class="breadcrumb-area section-padding-1 bg-gray breadcrumb-ptb-1">
        <div class="container-fluid">
            <div class="breadcrumb-content text-center">
                <div class="breadcrumb-title">
                    <h2>Checkout</h2>
                </div>
                <ul>
                    <li>
                        <a href="/home">Home 01 </a>
                    </li>
                    <li><span> &gt; </span></li>
                    <li class="active">Checkout </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- checkout start -->
    <div class="checkout-main-area pt-100 pb-100">
        <div class="container">
            <div class="customer-zone mb-30">
                <p class="cart-page-title">Have a coupon? <a class="checkout-click" href="#">Click here to enter your
                        code</a></p>
                <div class="checkout-login-info">
                    <p>If you have a coupon code, please apply it below.</p>
                    <form action="#">
                        <input type="text" placeholder="Coupon code">
                        <input type="submit" value="Apply Coupon">
                    </form>
                </div>
            </div>
            <div class="checkout-wrap">
                <div class="row">
                    <div class="col-lg-7">
                        <h3>Select an Address</h3>
                        <div class="address-selection">
                            <% if (userAddresses && userAddresses.addresses.length> 0) { %>
                                <!-- Address Selection Form -->
                                <form id="selectAddressForm">
                                    <% userAddresses.addresses.forEach((address, index)=> { %>
                                        <div class="address-option"
                                            style="border: 1px solid #e0e0e0; padding: 20px; margin-bottom: 15px; border-radius: 8px;">
                                            <div style="display: flex; align-items: flex-start;">
                                                <input type="radio" name="address" value="<%= address._id %>"
                                                    id="address<%= index %>" <%=index===0 ? 'checked' : '' %>
                                                class="address-radio"
                                                style="margin-top: 5px; margin-right: 10px;">
                                                <div style="flex-grow: 1;">
                                                    <label for="address<%= index %>"
                                                        style="font-weight: bold; font-size: 16px;">
                                                        <%= address.firstName %>
                                                            <%= address.lastName %>
                                                                <span
                                                                    style="background-color: #e8f5e9; color: #2e7d32; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;">
                                                                    <%= address.addressType.toUpperCase() %>
                                                                </span>
                                                    </label>
                                                    <div style="color: #666; margin-bottom: 5px;">
                                                        <%= address.houseNo %>, <%= address.street %>,
                                                                <% if (address.landmark) { %>
                                                                    <%= address.landmark %>,
                                                                        <% } %>
                                                                            <%= address.city %>, <%= address.district %>
                                                                                    , <%= address.state %> - <%=
                                                                                            address.pincode %>
                                                    </div>
                                                    <div style="color: #666;">
                                                        Mobile: <%= address.mobile %>
                                                    </div>
                                                    <div style="margin-top: 15px;">
                                                        <button type="button" class="remove-btn"
                                                            data-address-id="<%= address._id %>"
                                                            style="border: 1px solid #666; background: none; padding: 5px 15px; margin-right: 10px; border-radius: 4px;">
                                                            REMOVE
                                                        </button>

                                                        <a href="#editAddressModal-<%= address._id %>"
                                                            data-bs-toggle="modal" class="edit-btn"
                                                            style="border: 1px solid #666; background: none; padding: 5px 15px; border-radius: 4px;">
                                                            <i class="fa fa-edit"></i> Edit Address
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% }); %>
                                </form>
                                <% } else { %>
                                    <p>No addresses available. Please add an address.</p>
                                    <% } %>



                        <!-- Add New Address button -->
                        <div class="add-address-btn"
                            style="margin-top: 20px; padding: 15px; border: 2px dashed #fc4f4f; border-radius: 8px; cursor: pointer;">
                            <a href="#" data-bs-toggle="modal" data-bs-target="#addAddressModal"
                                style="color: #fc4f4f; text-decoration: none; display: block; text-align: center; font-weight: bold;">
                                + Add New Address
                            </a>
                        </div>

                        <!-- Payment Selection Section -->
                        <div class="payment-selection"
                            style="margin-top: 20px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #ffffff;">
                            <h3 style="margin-bottom: 15px;">Select Payment Method</h3>
                            <div class="payment-option" style="display: flex; align-items: center;">
                                <input type="radio" name="paymentMethod" value="Cash on Delivery" id="cod" checked
                                    class="payment-radio" style="margin-right: 10px; width: 20px; height: 20px;">
                                <label for="cod" class="payment-label" style="font-size: 16px; margin-bottom: 0;">Cash
                                    on
                                    Delivery</label>
                            </div>
                            <div class="payment-option" style="display: flex; align-items: center;">
                                <input type="radio" name="paymentMethod" value="Razorpay" id="Razorpay"
                                    class="payment-radio" style="margin-right: 10px; width: 20px; height: 20px;">
                                <label for="Razorpay" class="payment-label"
                                    style="font-size: 16px; margin-bottom: 0;">Razorpay</label>
                            </div>
                        </div>

                        </form>
                    </div>

                    <!-- Add Address Modal -->
                    <div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content p-3 p-lg-5">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="myaccount-content">
                                        <div class="account-details-form">
                                            <form id="addAddressForm" action="/add-address" method="post">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="firstName" class="required">First Name
                                                                <span>*</span></label>
                                                            <input type="text" id="firstName" name="firstName"
                                                                required />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="lastName" class="required">Last Name
                                                                <span>*</span></label>
                                                            <input type="text" id="lastName" name="lastName" required />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="addressType" class="required">Address Type
                                                                <span>*</span></label>
                                                            <select id="addressType" name="addressType" required
                                                                class="form-select">
                                                                <option value="" disabled selected>Select Address
                                                                    Type</option>
                                                                <option value="home">Home</option>
                                                                <option value="office">Office</option>
                                                                <option value="temporary">Temporary</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="houseNo" class="required">House Number
                                                                <span>*</span></label>
                                                            <input type="text" id="houseNo" name="houseNo" required />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="street" class="required">Street
                                                                <span>*</span></label>
                                                            <input type="text" id="street" name="street" required />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="landmark">Landmark</label>
                                                            <input type="text" id="landmark" name="landmark" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="city" class="required">City
                                                                <span>*</span></label>
                                                            <input type="text" id="city" name="city" required />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="district" class="required">District
                                                                <span>*</span></label>
                                                            <input type="text" id="district" name="district" required />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="state" class="required">State
                                                                <span>*</span></label>
                                                            <input type="text" id="state" name="state" required />
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="pincode" class="required">Pincode
                                                                <span>*</span></label>
                                                            <input type="text" id="pincode" name="pincode" required />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="single-input-item">
                                                    <button type="submit" class="check-btn sqr-btn">Save
                                                        Address</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <% if (userAddresses && userAddresses.addresses && userAddresses.addresses.length> 0) { %>
                        <% userAddresses.addresses.forEach(address=> { %>
                            <!-- Edit Address Modal for each address -->
                            <div class="modal fade" id="editAddressModal-<%= address._id %>" tabindex="-1"
                                aria-labelledby="editAddressModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content p-3 p-lg-5">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="myaccount-content">
                                                <div class="account-details-form">
                                                    <!-- Form with unique ID and class for AJAX functionality -->
                                                    <form id="editAddressForm-<%= address._id %>"
                                                        class="editAddressForm"
                                                        action="/edit-address/<%= address._id %>" method="POST">
                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="firstName-<%= address._id %>"
                                                                        class="required">First Name
                                                                        <span>*</span></label>
                                                                    <input type="text" id="firstName-<%= address._id %>"
                                                                        name="firstName"
                                                                        value="<%= address.firstName %>" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="lastName-<%= address._id %>"
                                                                        class="required">Last Name
                                                                        <span>*</span></label>
                                                                    <input type="text" id="lastName-<%= address._id %>"
                                                                        name="lastName" value="<%= address.lastName %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="addressType-<%= address._id %>"
                                                                        class="required">Address Type
                                                                        <span>*</span></label>
                                                                    <select id="addressType-<%= address._id %>"
                                                                        name="addressType" required class="form-select">
                                                                        <option value="" disabled>Select Address
                                                                            Type</option>
                                                                        <option value="home"
                                                                            <%=address.addressType==='home' ? 'selected'
                                                                            : '' %>>Home</option>
                                                                        <option value="office"
                                                                            <%=address.addressType==='office'
                                                                            ? 'selected' : '' %>>Office</option>
                                                                        <option value="temporary"
                                                                            <%=address.addressType==='temporary'
                                                                            ? 'selected' : '' %>>Temporary</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="houseNo-<%= address._id %>"
                                                                        class="required">House Number
                                                                        <span>*</span></label>
                                                                    <input type="text" id="houseNo-<%= address._id %>"
                                                                        name="houseNo" value="<%= address.houseNo %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="street-<%= address._id %>"
                                                                        class="required">Street
                                                                        <span>*</span></label>
                                                                    <input type="text" id="street-<%= address._id %>"
                                                                        name="street" value="<%= address.street %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label
                                                                        for="landmark-<%= address._id %>">Landmark</label>
                                                                    <input type="text" id="landmark-<%= address._id %>"
                                                                        name="landmark"
                                                                        value="<%= address.landmark %>" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="city-<%= address._id %>"
                                                                        class="required">City <span>*</span></label>
                                                                    <input type="text" id="city-<%= address._id %>"
                                                                        name="city" value="<%= address.city %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="district-<%= address._id %>"
                                                                        class="required">District
                                                                        <span>*</span></label>
                                                                    <input type="text" id="district-<%= address._id %>"
                                                                        name="district" value="<%= address.district %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="state-<%= address._id %>"
                                                                        class="required">State
                                                                        <span>*</span></label>
                                                                    <input type="text" id="state-<%= address._id %>"
                                                                        name="state" value="<%= address.state %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div class="single-input-item">
                                                                    <label for="pincode-<%= address._id %>"
                                                                        class="required">Pincode
                                                                        <span>*</span></label>
                                                                    <input type="text" id="pincode-<%= address._id %>"
                                                                        name="pincode" value="<%= address.pincode %>"
                                                                        required />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Add other fields similarly -->
                                                        <div class="single-input-item">
                                                            <button type="submit" class="check-btn sqr-btn">Save
                                                                Changes</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <p>No addresses available.</p>
                                    <% } %>




                </div>

                <div class="col-lg-5">
                    <div class="your-order-area">
                        <h3>Your order</h3>

                        <!-- Moved the product image here, below the heading -->
                        <% if(items[0].product.images.length> 0) { %>
                            <img src="/admin/productImages/<%= items[0].product.images[0] %>"
                                alt="<%= items[0].product.name %>" height="90px" width="90px"
                                style="display: block; margin: 15px auto;">
                            <% } else { %>
                                <img src="defaultImage.jpg" alt="No Image" height="90px" width="90px"
                                    style="display: block; margin: 15px auto;">
                                <% } %>

                                    <div class="your-order-wrap gray-bg-4">
                                        <div class="your-order-info-wrap">
                                            <div class="your-order-info">
                                                <ul>
                                                    <li>Product <span>Total</span></li>
                                                </ul>
                                            </div>
                                            <div class="your-order-middle">
                                                <ul>
                                                    <% let subtotal=0; let total=0; let deliveryCharges=50; %>
                                                        <% items.forEach(item=> { %>
                                                            <li style="display: flex; align-items: center;">
                                                                <%= item.product.name %> X <%= item.quantity %>
                                                                        <span style="margin-left: auto;">$<%=
                                                                                (item.product.discountPrice *
                                                                                item.quantity).toFixed(2) %></span>
                                                            </li>
                                                            <% subtotal +=item.product.price * item.quantity; total
                                                                +=item.product.discountPrice * item.quantity; %>
                                                                <% }); %>
                                                </ul>
                                            </div>
                                            <div class="your-order-info order-subtotal">
                                                <ul>
                                                    <li>Subtotal <span>$<%= subtotal.toFixed(2) %></span></li>
                                                </ul>
                                            </div>
                                            <div class="your-order-info order-delivery">
                                                <ul>
                                                    <li>Delivery Charges <span>$<%= deliveryCharges.toFixed(2) %>
                                                        </span></li>
                                                </ul>
                                            </div>
                                            <div class="your-order-info order-total">
                                                <ul>
                                                    <!-- Adding deliveryCharges to total -->
                                                    <li>Total <span>$<%= (total + deliveryCharges).toFixed(2) %>
                                                        </span></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="place-order-btn mt-30">
                                        <button type="submit" onclick="placeOrder()">Place
                                            Order</button>
                                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        async function placeOrder() {
            try {
                // Prevent default form submission
                console.log('placeorder script');

                const selectedAddress = document.querySelector('input[name="address"]:checked').value;
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

                // Send the selected address and payment method to the backend
                const response = await fetch('/place-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        selectedAddress,
                        paymentMethod,
                    }),
                });

                const data = await response.json();

                if (!data.success) {
                    alert(data.message || 'Order placement failed.');
                    return;
                }

                if (paymentMethod === 'Razorpay') {
                    // Trigger Razorpay interface
                    initiateRazorpayPayment(data);
                } else {
                    // Redirect for non-Razorpay payments
                    window.location.href = data.redirectUrl;
                    // window.location.href = `/order-confirmation?orderId=${data.orderId}`;
                }
            } catch (error) {
                console.error('Error placing order:', error);
                alert('Something went wrong. Please try again.');
            }
        }

        function initiateRazorpayPayment(data) {
            const options = {
                key: data.key,
                amount: data.amount,
                currency: data.currency,
                name: data.name,
                description: data.description,
                order_id: data.razorpayOrderId,
                handler: function (response) {
                    verifyPayment(response, data.orderId);
                },
                theme: { color: "#fc4f4f" },
            };

            const rzp = new Razorpay(options);
            rzp.on('payment.failed', function (response) {
                alert('Payment failed. Please try again.');
            });
            rzp.open();
        }

        async function verifyPayment(paymentDetails, orderId) {
            try {
                const response = await fetch('/verify-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        paymentDetails,
                        orderId,
                    }),
                });

                const data = await response.json();
                if (data.success) {
                    window.location.href = `/order-confirmation?orderId=${orderId}`;
                } else {
                    alert(data.message || 'Payment verification failed.');
                }
            } catch (error) {
                console.error('Error verifying payment:', error);
                alert('Something went wrong during payment verification.');
            }
        }
    </script>


    <!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <script>
        const form = document.getElementById('selectAddressForm');
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            console.log('ok');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const dataString = JSON.stringify(data)
            console.log("script   " + dataString);

            const response = await fetch('/place-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            const jsonResponse = await response.json();
            console.log('Response from backend:', jsonResponse);

            const initiateRazorpayPayment = (orderData) => {
                console.log('intilise razorpay');

                const options = {
                    key: orderData?.key, // Replace with your Razorpay key_id
                    amount: orderData?.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    currency: orderData?.currency,
                    name: orderData?.name,
                    description: orderData?.description,
                    order_id: orderData?.orderId, // This is the order_id created in the backend
                    callback_url: 'http://localhost:3000/payment-success', // Your success URL
                    prefill: {
                        name: 'Gaurav Kumar',
                        email: 'gaurav.kumar@example.com',
                        contact: '9999999999'
                    },
                    theme: {
                        color: '#F37254'
                    },
                };

                const rzp = new Razorpay(options);
                rzp.open();

            }

            if (jsonResponse.success) {
                initiateRazorpayPayment(jsonResponse);
            } else {
                alert(jsonResponse.message || "Failed to place order. Please try again.");
            }
            

        })
    </script> -->
    <!-- checkout end -->
    <%- include ('../layouts/footer') %>