<footer class="footer-area section-padding-1 border-top-3">
    <div class="container-fluid">
        <div class="footer-top pt-100 pb-60">
            <div class="row">
                <div class="footer-column footer-width-24">
                    <div class="footer-widget footer-about mb-30">
                        <a href="index.html">
                            <img src="/assets/images/logo/logo.png" alt="logo">
                        </a>
                        <p>Lorem ipsum dolor sit amet, magna habemus ius ad, qui minimum voluptar</p>
                        <div class="social-icon-style-2 social-icon-hm4">
                            <a class="facebook" href="#"><i class="fa fa-facebook"></i></a>
                            <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
                            <a class="youtube" href="#"><i class="fa fa-youtube"></i></a>
                            <a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-column footer-width-12">
                    <div class="footer-widget footer-info-list-2 mb-30">
                        <h3 class="footer-title">Company Link</h3>
                        <ul>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Help Center</a></li>
                            <li><a href="#">Our Team</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">The Blog</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-column footer-width-14">
                    <div class="footer-widget footer-info-list-2 mb-30">
                        <h3 class="footer-title">Userful Link</h3>
                        <ul>
                            <li><a href="#">Guides & Articles</a></li>
                            <li><a href="#">Customer Reviews</a></li>
                            <li><a href="#">Coupon Codes</a></li>
                            <li><a href="#">Military Discount</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-column footer-width-19">
                    <div class="footer-widget footer-info-list-2 footer-contect mb-30">
                        <h3 class="footer-title">Contact info</h3>
                        <ul>
                            <li><i class="dlicon ui-2_time-clock"></i> Monday - Friday: 9:00 - 19:00</li>
                            <li><i class="dlicon ui-1_email-83"></i> info@example.com</li>
                            <li><i class="dlicon tech-2_rotate"></i> (+612) 2531 5600</li>
                            <li><i class="dlicon ui-1_home-simple"></i> PO Box 1622 Colins Street West Victoria
                                8077 Australia</li>
                        </ul>
                    </div>
                </div>
                <div class="footer-column footer-width-29 mb-30">
                    <div class="contact-page-map">
                        <div id="contact-map">
                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3151.838709675939!2d144.95320007668528!3d-37.817246734238516!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6ad65d4dd5a05d97%3A0x3e64f855a564844d!2s121%20King%20St%2C%20Melbourne%20VIC%203000%2C%20Australia!5e0!3m2!1sen!2sus!4v1670477011653!5m2!1sen!2sus"
                                style="border:0;width:100%;height:100%;" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-botoom">
            <div class="row">
                <div class="col-12">
                    <div class="copyright-2 text-center">
                        <p>Â© 2021 <a href="https://hasthemes.com/">Toro.</a> All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<div class="support-lists">
    <ul>
        <li><a href="#"><i class="dlicon ui-3_chat-46"></i></a></li>
        <li><a href="#"><i class=" dlicon ui-3_phone"></i></a></li>
        <li><a href="#"><i class="dlicon ui-1_email-85"></i></a></li>
    </ul>
</div>
<div class="view-demo-area">
    <a class="view-demo-btn-active" href="#">More Demos</a>
    <div class="view-demo-aside-active">
        <div class="view-demo-wrap">
            <div class="view-demo-tab-list nav">
                <a class="active" href="#view-demo-1" data-bs-toggle="tab">
                    Demo Group 01
                </a>
                <a href="#view-demo-2" data-bs-toggle="tab">
                    Demo Group 02
                </a>
                <a href="#view-demo-3" data-bs-toggle="tab">
                    Demo Group 03
                </a>
            </div>
            <div class="tab-content jump-2">
                <div id="view-demo-1" class="tab-pane active">
                    <div class="row">
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index.html">
                                        <img src="/assets/images/demo-img/h-1.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index.html">Home Demo 01</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-2.html">
                                        <img src="/assets/images/demo-img/h-2.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-2.html">Home Demo 02</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-3.html">
                                        <img src="/assets/images/demo-img/h-3.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-3.html">Home Demo 03</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-4.html">
                                        <img src="/assets/images/demo-img/h-4.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-4.html">Home Demo 04</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-5.html">
                                        <img src="/assets/images/demo-img/h-5.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-5.html">Home Demo 05</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-6.html">
                                        <img src="/assets/images/demo-img/h-6.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-6.html">Home Demo 06</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-7.html">
                                        <img src="/assets/images/demo-img/h-7.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-7.html">Home Demo 07</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-8.html">
                                        <img src="/assets/images/demo-img/h-8.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-8.html">Home Demo 08</a></h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="discover-more-btn">
                        <a href="#">Discover More</a>
                    </div>
                </div>
                <div id="view-demo-2" class="tab-pane">
                    <div class="row">
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-9.html">
                                        <img src="/assets/images/demo-img/h-9.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-9.html">Home Demo 09</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-10.html">
                                        <img src="/assets/images/demo-img/h-10.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-10.html">Home Demo 10</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-11.html">
                                        <img src="/assets/images/demo-img/h-11.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-11.html">Home Demo 11</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-12.html">
                                        <img src="/assets/images/demo-img/h-12.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-12.html">Home Demo 12</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-13.html">
                                        <img src="/assets/images/demo-img/h-13.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-13.html">Home Demo 13</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-14.html">
                                        <img src="/assets/images/demo-img/h-14.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-14.html">Home Demo 14</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-15.html">
                                        <img src="/assets/images/demo-img/h-15.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-15.html">Home Demo 15</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-16.html">
                                        <img src="/assets/images/demo-img/h-16.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-16.html">Home Demo 16</a></h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="discover-more-btn">
                        <a href="#">Discover More</a>
                    </div>
                </div>
                <div id="view-demo-3" class="tab-pane">
                    <div class="row">
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-17.html">
                                        <img src="/assets/images/demo-img/h-17.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-17.html">Home Demo 17</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-18.html">
                                        <img src="/assets/images/demo-img/h-18.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-18.html">Home Demo 18</a></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 col-sm-6">
                            <div class="demo-item mb-40">
                                <div class="demo-item-img">
                                    <a href="index-19.html">
                                        <img src="/assets/images/demo-img/h-19.jpg" alt="demo-img">
                                        <span>View Demo</span>
                                    </a>
                                </div>
                                <div class="demo-item-content">
                                    <h4><a href="index-19.html">Home Demo 19</a></h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="discover-more-btn">
                        <a href="#">Discover More</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- All JS is here
============================================ -->

<!-- Modernizer JS -->
<script src="/assets/js/vendor/modernizr-3.11.7.min.js"></script>
<!-- jquery -->
<script src="/assets/js/vendor/jquery-v3.6.0.min.js"></script>
<!-- Popper JS -->
<script src="/assets/js/vendor/popper.js"></script>
<!-- Bootstrap JS -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>
<script src="/assets/js/plugins/owl-carousel.js"></script>
<script src="/assets/js/plugins/slick.js"></script>
<script src="/assets/js/plugins/jarallax.min.js"></script>
<script src="/assets/js/plugins/countdown.js"></script>
<script src="/assets/js/plugins/magnific-popup.js"></script>
<script src="/assets/js/plugins/instafeed.js"></script>
<script src="/assets/js/plugins/tilt.js"></script>
<script src="/assets/js/plugins/images-loaded.js"></script>
<script src="/assets/js/plugins/isotope.js"></script>
<script src="/assets/js/plugins/scrolloverflow-fullpage.js"></script>
<script src="/assets/js/plugins/fullpage.js"></script>
<script src="/assets/js/plugins/jquery-ui.js"></script>
<script src="/assets/js/plugins/jquery-ui-touch-punch.js"></script>
<script src="/assets/js/plugins/easyzoom.js"></script>
<script src="/assets/js/plugins/resizesensor.js"></script>
<script src="/assets/js/plugins/sticky-sidebar.js"></script>
<script src="/assets/js/plugins/scrollup.js"></script>
<script src="/assets/js/plugins/select2.min.js"></script>
<script src="/assets/js/plugins/cookie.js"></script>
<script src="/assets/js/plugins/bpopup.js"></script>
<script src="/assets/js/plugins/wow.js"></script>
<script src="/assets/js/plugins/ajax-mail.js"></script>
<!-- Main JS -->
<script src="/assets/js/main.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!--razorpay-->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<!-- Your Size Selection Script -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const sizeOptions = document.querySelectorAll('.size-option');
        const selectedSizeInput = document.getElementById('selectedSize');
        const addToCartButton = document.getElementById('addToCartButton');

        sizeOptions.forEach(option => {
            option.addEventListener('click', function (event) {
                event.preventDefault();
                sizeOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                selectedSizeInput.value = this.getAttribute('data-size');
            });
        });

        addToCartButton.addEventListener('click', function (event) {
            if (!selectedSizeInput.value) {
                event.preventDefault();
                alert('Please select a size before adding to cart.');
            }
        });
    });

</script>

<script>
    // Function to create HTML for the new address
    function addAddressToPage(address) {
        // Select the container where the addresses are listed
        const addressSelectionDiv = document.getElementById('address-selection');

        // Create a new div element for the address
        const addressDiv = document.createElement('div');
        addressDiv.className = 'address-item'; // Add class for styling

        // Set up the HTML structure for the new address
        addressDiv.innerHTML = `
            <h4>${address.firstName} ${address.lastName}</h4>
            <p>${address.houseNo}, ${address.street}, ${address.landmark}</p>
            <p>${address.city}, ${address.district}, ${address.state} - ${address.pincode}</p>
            <p>Type: ${address.addressType}</p>
            <button onclick="selectAddress('${address._id}')">Select this Address</button>
        `;

        // Append the new address to the address selection div
        addressSelectionDiv.appendChild(addressDiv);
    }

    // Function to handle form submission for adding an address
    async function submitAddressForm(event) {
        event.preventDefault(); // Prevent form from submitting normally

        // Gather form data
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/add-address', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (result.success) {
                // If successful, add the new address to the page
                addAddressToPage(result.data); // Pass the newly added address
                alert(result.msg); // Show success message
            } else {
                alert(result.msg); // Show error message if any
            }
        } catch (error) {
            console.error('Error adding address:', error);
            alert('There was an error adding the address.');
        }
    }

    // Attach submit handler to the form
    document.getElementById('addressForm').addEventListener('submit', submitAddressForm);
</script>

<script>document.querySelectorAll('.remove-btn').forEach(button => {
        button.addEventListener('click', function () {
            const addressId = this.getAttribute('data-address-id');

            fetch(`/delete-address/${addressId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'  // Set the X-Requested-With header
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Address deleted successfully.');
                        location.reload();  // Refresh to update the addresses list
                    } else {
                        alert('Failed to delete address: ' + data.msg);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the address.');
                });
        });
    });
</script>

<script>
    // Select all wishlist buttons
    document.querySelectorAll('.wishlist-button').forEach(button => {
        button.addEventListener('click', async (event) => {
            event.preventDefault(); // Prevent default link behavior

            const productId = button.getAttribute('data-product-id'); // Get product ID

            try {
                // Send AJAX request to the server
                const response = await fetch('/add-to-wishlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ productId }),
                });

                const data = await response.json(); // Parse the JSON response
                if (response.ok) {
                    // Success feedback (e.g., change the icon or show a toast)
                    alert(data.message || 'Product added to wishlist');
                    button.querySelector('i').classList.add('added'); // Add a class for styling
                } else {
                    // Handle errors
                    alert(data.error || 'Failed to add to wishlist');
                }
            } catch (err) {
                console.error(err);
                alert('An error occurred. Please try again.');
            }
        });
    });
</script>

<script>
    document.querySelectorAll('.remove-from-wishlist').forEach((button) => {
        button.addEventListener('click', async (event) => {
            event.preventDefault();

            const productId = button.getAttribute('data-product-id');

            try {
                const response = await fetch('/remove-from-wishlist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productId }),
                });

                const data = await response.json();
                if (response.ok) {
                    alert(data.message);
                    // Remove the row from the table
                    button.closest('tr').remove();
                } else {
                    alert(data.error || 'Failed to remove product');
                }
            } catch (err) {
                console.error(err);
                alert('An error occurred. Please try again.');
            }
        });
    });
</script>

<script>function changeQuantity(itemId, change, currentQuantity, maxStock) {
        const newQuantity = currentQuantity + change;

        if (change > 0 && newQuantity > maxStock) {
            alert(`Only ${maxStock} items are available in stock.`);
            return;
        }

        fetch('/update-cart-item', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ itemId, change }),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload(); // reload
                } else {
                    alert(data.message || "Failed to update quantity.");
                }
            })
            .catch(error => console.error('Error:', error));
    }


</script>

<script>
    function setCouponCode(code) {
        const couponInput = document.getElementById('selectedCouponCode');
        couponInput.value = code;
    }

    document.getElementById('couponForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const couponCode = document.getElementById('selectedCouponCode').value;

        if (!couponCode) {
            Swal.fire({
                icon: 'warning',
                title: 'Warning',
                text: 'Please select or enter a coupon code.',
            });
            return;
        }

        try {
            const response = await fetch('/apply-coupon', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ couponCode }),
            });

            const data = await response.json();

            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Coupon Applied!',
                    text: `Discount Applied: â¹${data.discount}. New Total: â¹${data.newTotal}`,
                }).then(() => {
                    location.reload();
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.msg || 'Failed to apply coupon.',
                });
            }
        } catch (error) {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Server Error',
                text: 'Something went wrong while applying the coupon.',
            });
        }
    });
</script>

<script>
    document.getElementById('removeCouponBtn').addEventListener('click', async function () {
        try {
            const response = await fetch('/remove-coupon', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            });

            const data = await response.json();

            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Coupon Removed!',
                    text: `Discount removed. New Total: â¹${data.newTotal}`,
                }).then(() => {
                    location.reload();
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.msg || 'Failed to remove coupon.',
                });
            }
        } catch (error) {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Server Error',
                text: 'Something went wrong while removing the coupon.',
            });
        }
    });
</script>


<script>
    async function placeOrder() {
        try {
            const selectedAddressInput = document.querySelector('input[name="address"]:checked');
            if (!selectedAddressInput) {
                console.log('No address selected');
                Swal.fire('Please select an address.');
                return;
            }
            //adding .value later will not give TypeError if no value is selected
            const selectedAddress = selectedAddressInput.value;

            // Check if payment method exists
            const paymentMethodInput = document.querySelector('input[name="paymentMethod"]:checked');
            if (!paymentMethodInput) {
                console.log('No payment method selected');
                Swal.fire('Please select a payment method.');
                return;
            }

            const paymentMethod = paymentMethodInput.value;

            const response = await fetch('/place-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ selectedAddress, paymentMethod }),
            });

            const data = await response.json();

            if (!data.success) {
                Swal.fire(data.message || 'Order placement failed.');
                return;
            }

            if (paymentMethod === 'Razorpay') {
                initiateRazorpayPayment(data);
            } else {
                window.location.href = data.redirectUrl;
            }
        } catch (error) {
            console.error('Error placing order:', error);
            Swal.fire('Something went wrong. Please try again.');
        }
    }

    function initiateRazorpayPayment(data) {
        const options = {
            key: data.key,
            amount: data.amount,
            currency: data.currency,
            name: data.name,
            description: data.description,
            order_id: data.razorpayOrderId,
            handler: function (response) {
                verifyPayment(response, data.orderId);
            },
            theme: { color: "#fc4f4f" },
            modal: {
                escape: false, // prevent closing the modal with Esc key
                ondismiss: async function () {
                    await handlePaymentClosure(data.orderId);
                },
            },
        };

        const rzp = new Razorpay(options);

        rzp.on('payment.failed', async function (response) {
            await notifyPaymentFailure(data.orderId);

            Swal.fire('Payment failed. You will be redirected to view your order.').then(()=>{
                window.location.href = `/view-order?orderId=${data.orderId}`;
            });
            
        });

        rzp.open();
    }

    async function handlePaymentClosure(orderId) {
        try {
            // Notify the server about the payment failure
            await notifyPaymentFailure(orderId);

            // Alert the user and redirect
            Swal.fire({
                icon: 'info',
                title: 'Payment Window Closed',
                text: 'You closed the payment window. You will be redirected to view your order.',
                confirmButtonText: 'OK',
            }).then(() => {
                window.location.href = `/view-order?orderId=${orderId}`;
            });
        } catch (error) {
            console.error('Error handling payment closure:', error);
            alert('Something went wrong. Please check your order status.');
        }
    }



    async function verifyPayment(paymentDetails, orderId) {
        try {
            const response = await fetch('/verify-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ paymentDetails, orderId }),
            });

            const data = await response.json();
            if (data.success) {
                window.location.href = `/order-confirmation?orderId=${orderId}`;
            } else {
                alert(data.message || 'Payment verification failed.');
            }
        } catch (error) {
            console.error('Error verifying payment:', error);
            alert('Something went wrong during payment verification.');
        }
    }

    async function notifyPaymentFailure(orderId) {
        try {
            await fetch('/notify-payment-failure', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ orderId }),
            });
        } catch (error) {
            console.error('Error notifying payment failure:', error);
        }
    }
</script>

<script>
    document.getElementById("registerForm").addEventListener("submit", function (e) {
        let valid = true;

        const name = document.getElementById("name").value.trim();
        const nameError = document.getElementById("nameError");
        if (name === "") {
            nameError.textContent = "Name is required.";
            valid = false;
        } else {
            nameError.textContent = "";
        }

        const email = document.getElementById("email").value.trim();
        const emailError = document.getElementById("emailError");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailError.textContent = "Enter a valid email address.";
            valid = false;
        } else {
            emailError.textContent = "";
        }

        const mobile = document.getElementById("mobile").value.trim();
        const mobileError = document.getElementById("mobileError");
        const mobileRegex = /^[0-9]{10}$/;
        if (!mobileRegex.test(mobile)) {
            mobileError.textContent = "Enter a valid 10-digit mobile number.";
            valid = false;
        } else {
            mobileError.textContent = "";
        }

        const password = document.getElementById("password").value.trim();
        const passwordError = document.getElementById("passwordError");
        const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
        if (!passwordRegex.test(password)) {
            passwordError.textContent =
                "Password must be at least 6 characters, include 1 uppercase letter, 1 lowercase letter, 1 number, and 1 special character.";
            valid = false;
        } else {
            passwordError.textContent = "";
        }

        // Confirm Password validation
        const confirmPassword = document.getElementById("confirmPassword").value.trim();
        const confirmPasswordError = document.getElementById("confirmPasswordError");
        if (confirmPassword !== password) {
            confirmPasswordError.textContent = "Passwords do not match.";
            valid = false;
        } else {
            confirmPasswordError.textContent = "";
        }

        // form submission prevernted
        if (!valid) {
            e.preventDefault();
        }
    });
</script>

<script>
    document.getElementById("loginForm").addEventListener("submit", function (e) {
        let valid = true;

        const email = document.getElementById("loginEmail").value.trim();
        const emailError = document.getElementById("loginEmailError");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailError.textContent = "Enter a valid email address.";
            valid = false;
        } else {
            emailError.textContent = "";
        }

        const password = document.getElementById("loginPassword").value.trim();
        const passwordError = document.getElementById("loginPasswordError");
        if (password === "") {
            passwordError.textContent = "Password is required.";
            valid = false;
        } else {
            passwordError.textContent = "";
        }

        if (!valid) {
            e.preventDefault();
        }
    });
</script>

</body>


</html>